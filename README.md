# Blue Billywig YouTube Importer

Composer package allowing to easily import video's from a YouTube channel into a Blue Billywig VMS publication.

Currently it is only possible to import all video's from a YouTube channel/account in one go. All video's must be publicly accessible.

**DISCLAIMER**

Since YouTube changes it's API structure/permissions on a regular basis, youtube-dl, the import via the Blue Billywig API or this package may stop working without notice. 

## Usage

### Getting Started

This package uses the command line software youtube-dl under the hood. This piece of software **must** be installed on your machine in order to use this package. To install youtube-dl, follow these instruction [here](https://ytdl-org.github.io/youtube-dl/).

In order to communicate with the Blue Billywig API a shared secret is required. A shared secret can be generated by going to https://*YourPublication*.bbvms.com/ovp/#/publication/api-keys (where *YourPublication* needs to be substituted with the name of your publication) and clicking *CREATE NEW KEY*.

## Include bluebillywig-youtube-importer into your project

In the root of your project run the following command:

```sh
composer require wmrsp/bluebillywig-youtube-importer
```

## Downloading metadata

```php
<?php

require dirname(__FILE__) . "/vendor/autoload.php";

use wmrsp\BlueBillywig\YouTubeImporter\Importer;

$youtube_url = "https://www.youtube.com/user/myawesomeusername";
$publication_name = "YourPublication";
$publication_shared_secret = "123-1234567890abcdefghijklmnopqrstuv";

$importer = new Importer($youtube_url, $publication_name, $publication_shared_secret);

$importer->downloadYouTube();
```

This will download a json file for each video on the YouTube channel/account. These json files contain information about the YouTube video, amongst which the url of the particular video. In the next step this url will passed on to the Blue Billywig API so that the video may be imported.

The order in which the video's are imported into the Blue Billywig VMS is the order in which the json file reside in the downloads folder.

## Importing into the Blue Billywig VMS

```php
<?php

require dirname(__FILE__) . "/vendor/autoload.php";

use wmrsp\BlueBillywig\YouTubeImporter\Importer;

$youtube_url = "https://www.youtube.com/user/myawesomeusername";
$publication_name = "YourPublication";
$publication_shared_secret = "123-1234567890abcdefghijklmnopqrstuv";

$importer = new Importer($youtube_url, $publication_name, $publication_shared_secret);

$import_results = $importer->importDownloads();
print_r($import_results);
```

This will extract the video's url from each of the json files and pass it onto the Blue Billywig API, who in turn will import the video into the VMS. When it is all set and done the import results will be returned and saved in a log file in the logs folder.

Please do keep in mind that, in order to prevent overloading the Blue Billywig API, there is a timeout of 30 seconds between the import of each video.

## Full example

```php
<?php

require dirname(__FILE__) . "/vendor/autoload.php";

use wmrsp\BlueBillywig\YouTubeImporter\Importer;

$youtube_url = "https://www.youtube.com/user/myawesomeusername";
$publication_name = "YourPublication";
$publication_shared_secret = "123-1234567890abcdefghijklmnopqrstuv";

$importer = new Importer($youtube_url, $publication_name, $publication_shared_secret);

$importer->downloadYouTube();
$import_results = $importer->importDownloads();

print_r($import_results);
```

## Unit Testing

To run the PHP unit tests, copy `tests/config.example.yaml` to `tests/config.yaml` and update `tests/config.yml` with the settings that apply to your publication.

Run the tests with the following commands.

```php
./vendor/bin/phpunit --bootstrap ./vendor/autoload.php tests/FunctionsTest.php
./vendor/bin/phpunit --bootstrap ./vendor/autoload.php tests/ImporterTest.php
```